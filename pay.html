<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IronZone - Secure Payment</title>
    <!-- Favicon -->
<link rel="icon" type="image/png" href="/ironLogo.jpg">
<link rel="shortcut icon" type="image/png" href="/ironLogo.jpg">
<link rel="apple-touch-icon" href="/ironLogo.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Correct QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#9AC24B',
                        'primary-dark': '#7a9b3d',
                        'whatsapp-green': '#25D366'
                    }
                }
            }
        }

        const UPI_ID = 'ironzone@kvb'; 

        // const UPI_ID = 'mohammednabhaanvalai-2@okhdfcbank'; 
        const MERCHANT_NAME = 'IronZone Service';
        const MERCHANT_MCC = '7299';

        let currentOrderId = '';
        let currentAmount = 0;

        const showStatusMessage = (message, isError = false) => {
            const statusBox = document.getElementById('status-message-box');
            const statusText = document.getElementById('status-message-text');
            
            statusText.textContent = message;
            statusBox.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            
            if (isError) {
                statusBox.classList.add('bg-red-100', 'text-red-800');
            } else {
                statusBox.classList.add('bg-green-100', 'text-green-800');
            }
            setTimeout(() => statusBox.classList.add('hidden'), 5000);
        };

        const loadPaymentDetails = () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            const orderId = urlParams.get('orderId');
            const amount = parseFloat(urlParams.get('amount'));
            
            if (!orderId || isNaN(amount) || amount <= 0) {
                document.getElementById('payment-card').innerHTML = 
                    `<div class="p-6 text-center text-red-600">
                        <p class="font-bold">Error: Missing or invalid order details.</p>
                        <p>Please use the direct link shared to you via WhatsApp or contact support.</p>
                    </div>`;
                showStatusMessage('Invalid link parameters.', true);
                return;
            }

            currentOrderId = orderId;
            currentAmount = amount;

            document.getElementById('order-id').textContent = orderId;
            document.getElementById('amount-due').textContent = `₹${amount.toFixed(2)}`;
            
            // Update VPA display
            document.getElementById('vpa-display').value = UPI_ID;
            
            const dynamicUpiLink = `upi://pay?pa=${UPI_ID}&pn=${encodeURIComponent(MERCHANT_NAME)}&mc=${MERCHANT_MCC}&mode=02&purpose=00&am=${amount.toFixed(2)}&tr=${orderId}`;

            document.getElementById('pay-now-btn').href = dynamicUpiLink;

            const qrcodeContainer = document.getElementById('qrcode-container');
            qrcodeContainer.innerHTML = ''; 

            try {
                new QRCode(qrcodeContainer, {
                    text: dynamicUpiLink,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            } catch (error) {
                qrcodeContainer.innerHTML = '<p class="text-red-600 text-sm">QR Code generation failed</p>';
                console.error('QR Code Error:', error);
            }
            
            document.getElementById('pay-now-btn').onclick = (e) => {
                showStatusMessage('Redirecting to your UPI App...');
            };

            document.getElementById('copy-vpa-btn').onclick = () => {
                navigator.clipboard.writeText(UPI_ID).then(() => {
                    showStatusMessage('UPI VPA copied: ' + UPI_ID);
                }).catch(() => {
                    const tempInput = document.createElement('textarea');
                    tempInput.value = UPI_ID;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    showStatusMessage('UPI VPA copied: ' + UPI_ID);
                });
            };
        };

        window.onload = loadPaymentDetails;
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div id="payment-card" class="w-full max-w-md bg-white shadow-xl rounded-xl overflow-hidden">
        
        <div class="bg-primary p-6">
            <h1 class="text-3xl font-extrabold text-white text-center">IronZone Payment</h1>
            <p class="text-white text-center text-sm mt-1 opacity-90">Securely powered by UPI Intent</p>
        </div>

        <div id="status-message-box" class="hidden mx-4 mt-4 p-3 rounded-lg text-sm font-medium border border-transparent">
            <p id="status-message-text"></p>
        </div>

        <div class="p-6 border-b border-gray-100">
            <div class="flex justify-between items-center mb-4">
                <p class="text-lg text-gray-600 font-medium">Order ID</p>
                <p id="order-id" class="text-lg font-bold text-gray-800">#LOADING...</p>
            </div>
            <div class="flex justify-between items-center">
                <p class="text-xl font-semibold text-gray-700">Total Amount Due</p>
                <p id="amount-due" class="text-3xl font-extrabold text-primary">₹0.00</p>
            </div>
        </div>

        <div class="p-6 space-y-6">
            
            <div class="space-y-3">
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2 text-blue-600">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-4.28 9.22a.75.75 0 0 0 0 1.06l3 3a.75.75 0 1 0 1.06-1.06l-1.72-1.72h5.69a.75.75 0 0 0 0-1.5h-5.69l1.72-1.72a.75.75 0 0 0-1.06-1.06l-3 3Z" clip-rule="evenodd" />
                    </svg>
                    Pay with UPI App
                </h2>
                <a id="pay-now-btn" href="#" 
                   class="block text-center w-full py-3 px-4 bg-whatsapp-green text-white font-bold rounded-lg shadow-md transition duration-200 hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300">
                    Pay Now via UPI App
                </a>
                <p class="text-xs text-gray-500 text-center">Tapping this redirects you to Google Pay, PhonePe, or Paytm.</p>
            </div>

            <div class="flex items-center">
                <div class="flex-grow border-t border-gray-200"></div>
                <span class="flex-shrink mx-4 text-gray-500 text-sm">OR</span>
                <div class="flex-grow border-t border-gray-200"></div>
            </div>

            <div class="space-y-3 text-center">
                <h2 class="text-xl font-bold text-gray-800 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2 text-primary">
                        <path fill-rule="evenodd" d="M3 5.25a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v13.5a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V5.25Zm4.5-.75a.75.75 0 0 0-.75.75v1.5c0 .414.336.75.75.75h1.5a.75.75 0 0 0 .75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5Zm-.75 7.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5Zm12-.75a.75.75 0 0 0-.75.75v1.5c0 .414.336.75.75.75h1.5a.75.75 0 0 0 .75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5ZM12 7.5a.75.75 0 0 0-.75.75v1.5c0 .414.336.75.75.75h1.5a.75.75 0 0 0 .75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5Zm-.75 7.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5Z" clip-rule="evenodd" />
                    </svg>
                    Scan QR Code
                </h2>
                <div class="inline-block p-2 border-4 border-primary rounded-lg shadow-lg">
                    <div id="qrcode-container" class="w-[200px] h-[200px] flex items-center justify-center"></div>
                </div>
                <p class="text-sm text-gray-600">Scan this from any UPI app on another device.</p>
            </div>
            
            <div class="pt-4 border-t border-gray-100">
                <p class="text-sm text-gray-700 font-medium mb-2">Manual Payment (Enter VPA):</p>
                <div class="flex items-center space-x-2">
                    <input type="text" readonly id="vpa-display" class="flex-grow p-2 text-sm bg-gray-100 border border-gray-300 rounded-lg font-mono text-gray-800 cursor-text select-all">
                    <button id="copy-vpa-btn" class="bg-primary-dark hover:bg-primary-dark/80 text-white p-2 rounded-lg text-sm transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
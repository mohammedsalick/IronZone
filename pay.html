//IronZoneWEb/pay.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IronZone - Secure Payment</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Set Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#9AC24B',
                        'primary-dark': '#7a9b3d',
                        'whatsapp-green': '#25D366'
                    }
                }
            }
        }

        // --- MOCK MERCHANT DETAILS (REPLACE WITH YOUR LIVE DATA) ---
        const MERCHANT_UPI_VPA = 'ironzone@kyb'; // Your correct merchant VPA
        const MERCHANT_NAME = 'IronZone Service';
        const MERCHANT_MCC = '7299'; // Merchant Category Code for Cleaning/Laundry Services
        const BASE_UPI_LINK = `upi://pay?pa=${MERCHANT_UPI_VPA}&pn=${encodeURIComponent(MERCHANT_NAME)}&mc=${MERCHANT_MCC}&mode=02&purpose=00&am=AMOUNT&tr=ORDER_ID`;
        // -------------------------------------------------------------

        let currentOrderId = '';
        let currentAmount = 0;

        // Function to show a clean status message (replaces alert())
        const showStatusMessage = (message, isError = false) => {
            const statusBox = document.getElementById('status-message-box');
            const statusText = document.getElementById('status-message-text');
            
            statusText.textContent = message;
            statusBox.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            
            if (isError) {
                statusBox.classList.add('bg-red-100', 'text-red-800');
            } else {
                statusBox.classList.add('bg-green-100', 'text-green-800');
            }
            // Hide after 5 seconds
            setTimeout(() => statusBox.classList.add('hidden'), 5000);
        };


        // Function to parse URL and populate the page
        const loadPaymentDetails = () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // 1. Get and validate parameters
            const orderId = urlParams.get('orderId');
            const amount = parseFloat(urlParams.get('amount'));
            
            if (!orderId || isNaN(amount) || amount <= 0) {
                document.getElementById('payment-card').innerHTML = 
                    `<div class="p-6 text-center text-red-600">
                        <p class="font-bold">Error: Missing or invalid order details.</p>
                        <p>Please use the direct link shared to you via WhatsApp or contact support.</p>
                    </div>`;
                showStatusMessage('Invalid link parameters.', true);
                return;
            }

            currentOrderId = orderId;
            currentAmount = amount;

            // 2. Update UI elements
            document.getElementById('order-id').textContent = orderId;
            document.getElementById('amount-due').textContent = `₹${amount.toFixed(2)}`;
            
            // 3. Generate the UPI Deep Link
            const dynamicUpiLink = BASE_UPI_LINK
                .replace('AMOUNT', amount.toFixed(2))
                .replace('ORDER_ID', orderId);

            document.getElementById('pay-now-btn').href = dynamicUpiLink;

            // 4. Generate the mock QR Code URL (For visual instruction only)
            const qrText = `Order: ${orderId} | Amount: ₹${amount.toFixed(2)}`;
            const qrPlaceholderUrl = `https://placehold.co/200x200/9AC24B/ffffff?text=${encodeURIComponent('Scan\nIronZone\n'+orderId)}&font=inter`;
            document.getElementById('qr-code-img').src = qrPlaceholderUrl;
            
            // 5. Simulate a successful payment update after a click (for demo purposes)
            document.getElementById('pay-now-btn').onclick = (e) => {
                // e.preventDefault(); // Uncomment in a real scenario if you use a PG to capture clicks before redirect
                showStatusMessage('Redirecting to your UPI App...');
            };

             document.getElementById('copy-vpa-btn').onclick = () => {
                const tempInput = document.createElement('textarea');
                tempInput.value = MERCHANT_UPI_VPA;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                showStatusMessage('UPI VPA copied: ' + MERCHANT_UPI_VPA);
            };
        };


        window.onload = loadPaymentDetails;
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div id="payment-card" class="w-full max-w-md bg-white shadow-xl rounded-xl overflow-hidden">
        
        <!-- Header -->
        <div class="bg-primary p-6">
            <h1 class="text-3xl font-extrabold text-white text-center">IronZone Payment</h1>
            <p class="text-white text-center text-sm mt-1 opacity-90">Securely powered by UPI Intent</p>
        </div>

        <!-- Status Message Box -->
        <div id="status-message-box" class="hidden mx-4 mt-4 p-3 rounded-lg text-sm font-medium border border-transparent">
            <p id="status-message-text"></p>
        </div>

        <!-- Order Summary -->
        <div class="p-6 border-b border-gray-100">
            <div class="flex justify-between items-center mb-4">
                <p class="text-lg text-gray-600 font-medium">Order ID</p>
                <p id="order-id" class="text-lg font-bold text-gray-800">#LOADING...</p>
            </div>
            <div class="flex justify-between items-center">
                <p class="text-xl font-semibold text-gray-700">Total Amount Due</p>
                <p id="amount-due" class="text-3xl font-extrabold text-primary">₹0.00</p>
            </div>
        </div>

        <!-- Payment Options -->
        <div class="p-6 space-y-6">
            
            <!-- UPI Intent Button (Mobile Flow) -->
            <div class="space-y-3">
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2 text-blue-600">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-4.28 9.22a.75.75 0 0 0 0 1.06l3 3a.75.75 0 1 0 1.06-1.06l-1.72-1.72h5.69a.75.75 0 0 0 0-1.5h-5.69l1.72-1.72a.75.75 0 0 0-1.06-1.06l-3 3Z" clip-rule="evenodd" />
                    </svg>
                    Pay with UPI App
                </h2>
                <a id="pay-now-btn" href="#" 
                   class="block text-center w-full py-3 px-4 bg-whatsapp-green text-white font-bold rounded-lg shadow-md transition duration-200 hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300">
                    Pay Now via UPI App
                </a>
                <p class="text-xs text-gray-500 text-center">Tapping this redirects you to Google Pay, PhonePe, or Paytm.</p>
            </div>

            <!-- Separator -->
            <div class="flex items-center">
                <div class="flex-grow border-t border-gray-200"></div>
                <span class="flex-shrink mx-4 text-gray-500 text-sm">OR</span>
                <div class="flex-grow border-t border-gray-200"></div>
            </div>

            <!-- QR Code (Desktop/Scan Flow) -->
            <div class="space-y-3 text-center">
                <h2 class="text-xl font-bold text-gray-800 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2 text-primary">
                        <path fill-rule="evenodd" d="M3 5.25a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v13.5a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V5.25Zm4.5-.75a.75.75 0 0 0-.75.75v1.5c0 .414.336.75.75.75h1.5a.75.75 0 0 0 .75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5Zm-.75 7.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5Zm12-.75a.75.75 0 0 0-.75.75v1.5c0 .414.336.75.75.75h1.5a.75.75 0 0 0 .75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5ZM12 7.5a.75.75 0 0 0-.75.75v1.5c0 .414.336.75.75.75h1.5a.75.75 0 0 0 .75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5Zm-.75 7.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5Z" clip-rule="evenodd" />
                    </svg>
                    Scan QR Code
                </h2>
                <div class="inline-block p-2 border-4 border-primary rounded-lg shadow-lg">
                    <img id="qr-code-img" src="" alt="UPI QR Code for Payment" class="w-48 h-48 rounded-md" />
                </div>
                <p class="text-sm text-gray-600">Scan this from any UPI app on another device.</p>
            </div>
            
             <!-- Manual UPI VPA -->
             <div class="pt-4 border-t border-gray-100">
                <p class="text-sm text-gray-700 font-medium mb-2">Manual Payment (Enter VPA):</p>
                <div class="flex items-center space-x-2">
                    <input type="text" readonly id="vpa-display" value="${MERCHANT_UPI_VPA}" class="flex-grow p-2 text-sm bg-gray-100 border border-gray-300 rounded-lg font-mono text-gray-800 cursor-text select-all">
                    <button id="copy-vpa-btn" class="bg-primary-dark hover:bg-primary-dark/80 text-white p-2 rounded-lg text-sm transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v2.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V6.75a1.5 1.5 0 0 1 1.5-1.5h2.25M11.25 7.75l4.5 4.5m0 0-4.5 4.5m4.5-4.5H3" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        
    </div>
</body>
</html>
